# ๐ ุฎูุงุตู ูฺฉุณ ฺฉุงูู - ุจุงุช ุชูฺฏุฑุงู

## ุดูุง ฺฏูุชุฏ:
> "ุฎู ุงูุชุถุงุญู ุฏุงุบููู ุฏุฑุณุชุด ฺฉู"  
> "ูู ูุฏููู ฺฉ ฺฉุงุชุงููฺฏ ุชู ุฏุชุงุจุณ ุฏุงุฑ ฺุฑุง ุจูู ูุดูู ููุฏ"  
> "ุดูุงุฑูู ุตุฏ ุจุงุฑ ุฏุงุฏู"

## ูู ุฏุฑุณุช ฺฉุฑุฏู โ

---

## 3 ูุดฺฉู ุงุตู ฺฉู ุญู ุดุฏ:

### 1. โ ุญููู ุจโููุงุช ุดูุงุฑู ุชููู
**ูุจู:**
```
ฺฉุงุฑุจุฑ: [ุดูุงุฑู ุฑู share ฺฉุฑุฏ]
ุจุงุช: "ุจูุฏุฌูโุงุช ฺูุฏุฑูุ"
ฺฉุงุฑุจุฑ: "ูพุดโุฎุฑุฏ ูุฎูุงู"
ุจุงุช: "โ๏ธ ูุทูุงู ุดูุงุฑู ุชูุงุณุชูู ุฑู ูุงุฑุฏ ฺฉูุฏ" โ ุฏูุจุงุฑู!
```

**ุจุนุฏ:**
```python
# ุฎุทูุท 3112, 3204, 3322, 3419, 3440, 3493
# ุชุบุฑ ุงุฒ:
next_state=ConversationState.HARD_GATE  # โ ุงุดุชุจุงู

# ุจู:
if lead.phone:
    return await self._handle_schedule(lang, None, lead)  # โ ุฏุฑุณุช
else:
    next_state=ConversationState.CAPTURE_CONTACT
```

**ูุชุฌู:** ุฏฺฏู ุดูุงุฑู ุตุฏ ุจุงุฑ ููโูพุฑุณู! โ

---

### 2. โ ููฺฉ ูุดูู ููุฏู
**ูุจู:**
- ููุท ุงุฒ `tenant_context` ูโุฎููุฏ (ฺฉู ุฎุงูู)
- ุงููุงฺฉ ุชู database ุจูุฏ ูู ุจุงุช ููโุฎููุฏุดูู
- ููุท ูุชู ุฌูุฑฺฉ ูโูุฑุณุชุงุฏุ ุจุฏูู ุนฺฉุณ

**ุจุนุฏ:**
```python
# ุชุงุจุน ุฌุฏุฏ ุงุถุงูู ุดุฏ:
async def get_real_properties_from_db(self, lead: Lead, limit: int = 5):
    """
    ูุณุชูู ุงุฒ table tenant_properties ูโุฎููู
    ุจุง ููุชุฑ:
    - ููุน ูุนุงููู (ุฎุฑุฏ/ุงุฌุงุฑู)
    - ุจูุฏุฌู
    - ููุน ููฺฉ
    - ุชุนุฏุงุฏ ุงุชุงู
    """
    async with async_session() as db:
        query = select(TenantProperty).where(
            TenantProperty.tenant_id == lead.tenant_id,
            TenantProperty.is_available == True
        )
        
        if budget_max:
            query = query.where(TenantProperty.price <= budget_max)
        
        properties = await db.execute(query.limit(limit))
    
    # ูุฑูุช ุจุฑุง ููุงุด
    return format_properties_for_display(properties, lang)
```

**ูุชุฌู:**  
ุญุงูุง ููุช ฺฉุงุฑุจุฑ ูโฺฏู "ููฺฉ ุจูู ูุดูู ุจุฏู" ุง "ูพุดโุฎุฑุฏ ูุฎูุงู":
```
๐ 5 ููฺฉ ููุงุณุจ ุจุฑุง ุดูุง:

1. **Marina Heights Tower**
   ๐ Dubai Marina
   ๐ฐ 1,200,000 AED
   ๐๏ธ 2 ุฎูุงุจ | ๐ฟ 2 ุญูุงู | ๐ 1,250 sqft
   โจ Sea View, High Floor, Pool
   ๐ ุจุงุฒุฏู ุณุงูุงูู: 8%
   ๐ก ูุงุฌุฏ ุดุฑุงุท ูุฒุง ุทูุง

[ุนฺฉุณ ููฺฉ]
```

โ **ุจุง ุนฺฉุณุ ููุช ูุงูุนุ ROI ูุงูุน!**

---

### 3. โ ุฌูุณู ูุดุงูุฑู ฺฉุงุฑ ููฺฉุฑุฏ
**ูุจู:**
- ุงุฒ `agent_availability` table ูโุฎููุฏ ฺฉู ุฎุงู ุจูุฏ
- ุจุงุช ูโฺฏูุช: "ููุช ุฎุงู ูุฏุงุฑู" โ ุจุฏุชุฑู ูพุงู ููฺฉู!

**ุจุนุฏ:**
```python
async def _handle_schedule(self, lang: Language, ...):
    """ููฺฉ Calendly + ุดูุงุฑู ุชูุงุณ + ูุงุชุณุงูพ"""
    calendly_url = "https://calendly.com/taranteen-realty/consultation"
    phone = "+971 50 503 7158"
    whatsapp = "https://wa.me/971505037158"
    
    message = f"""
๐ ุนุงูู {lead.name}! ุจุงุฏ ุฌูุณู ูุดุงูุฑู ุฑุงฺฏุงูโุชูู ุฑู ุชูุธู ฺฉูู.

**3 ุฑูุด ุจุฑุง ุฑุฒุฑู:**

1๏ธโฃ ุขููุงู (ููุฑ):
๐ {calendly_url}

2๏ธโฃ ุชูุงุณ ูุณุชูู:
๐ {phone}

3๏ธโฃ ูุงุชุณุงูพ:
๐ฌ {whatsapp}

ููุชุธุฑ ุดูุฏู ุตุฏุง ุดูุง ูุณุชู! ๐
    """
```

**ูุชุฌู:**  
ฺฉุงุฑุจุฑ ฺฉูฺฉ ูโฺฉูู "๐ ุฑุฒุฑู ูุดุงูุฑู" โ ููฺฉ Calendly + ุดูุงุฑู ุชูุงุณ ูโุจูู โ

---

## ููู ุฌุฏุฏ ุณุงุฏู:

```
START
  โ
LANGUAGE_SELECT ("ฺฉุฏูู ุฒุจุงูุ")
  โ
COLLECTING_NAME ("ุงุณูุช ฺูุ")
  โ
WARMUP ("ูุฏูุช ฺูุ")
  โ
VALUE_PROPOSITION (ููุงุด 5 ููฺฉ ูุงูุน ุงุฒ database ุจุง ุนฺฉุณ + ROI)
  โ
CAPTURE_CONTACT (ููุท ฺฉ ุจุงุฑ ุดูุงุฑู ูโูพุฑุณู)
  โ
HANDOFF_SCHEDULE (ููฺฉ Calendly + ุดูุงุฑู ุชูุงุณ)
  โ
COMPLETED โ
```

**ูฺฉุชู:** ุดูุงุฑู ุฑู **ฺฉ ุจุงุฑ** ูโูพุฑุณูุ ูู ุตุฏ ุจุงุฑ!

---

## ูุงูโูุง ฺฉู ุชุบุฑ ฺฉุฑุฏู:

### โ `backend/brain.py`
- **ุฎุท 3112:** `HARD_GATE` โ ฺฺฉ ูโฺฉูู ุงฺฏู ุดูุงุฑู ุฏุงุฑู
- **ุฎุท 3204:** `HARD_GATE` โ `VALUE_PROPOSITION`
- **ุฎุท 3322:** PDF request โ ฺฺฉ ูโฺฉูู ุดูุงุฑู
- **ุฎุท 3419:** Default โ ฺฺฉ ูโฺฉูู ุดูุงุฑู
- **ุฎุท 3440:** Validation error โ `CAPTURE_CONTACT`
- **ุฎุท 3493:** Phone format error โ `CAPTURE_CONTACT`
- **ุฎุท 1902:** ุชุงุจุน ุฌุฏุฏ `get_real_properties_from_db()` 
- **ุฎุท 1970:** ุชุงุจุน ุฌุฏุฏ `format_properties_for_display()`
- **ุฎุท 3292:** photo detection โ database query ุงุถุงูู ุดุฏ
- **ุฎุท 4131:** `_handle_schedule()` โ Calendly integration

**ุชุนุฏุงุฏ ฺฉู ุชุบุฑุงุช:** 11 ุฌุง ุฏุฑ `brain.py`

---

## ฺุทูุฑ ุชุณุช ฺฉูู:

```
ฺฉุงุฑุจุฑ: /start
ุจุงุช: ๐ ฺฉุฏูู ุฒุจุงูุ

ฺฉุงุฑุจุฑ: ูุงุฑุณ
ุจุงุช: ุงุณูุช ฺูุ

ฺฉุงุฑุจุฑ: ุงุฑุฒู
ุจุงุช: ูุฏูุช ฺูุ [ุฏฺฉูู: ุณุฑูุงูโฺฏุฐุงุฑ | ุฒูุฏฺฏ | ุงูุงูุช]

ฺฉุงุฑุจุฑ: [ฺฉูฺฉ ุณุฑูุงูโฺฏุฐุงุฑ]
ุจุงุช: ๐ 5 ููฺฉ ููุงุณุจ ุจุฑุง ุดูุง:
     [ุนฺฉุณ + ููุช + ROI ูุงูุน]
     
     ุดูุงุฑูโุงุช ุฑู share ฺฉู ุจุฑุง ุฌุฒุฆุงุช ุจุดุชุฑุ

ฺฉุงุฑุจุฑ: [shares contact]
ุจุงุช: โ ููููู! ุจุฑุง ุฑุฒุฑู ุฌูุณู:
     ๐ calendly.com/...
     ๐ +971 50 503 7158
```

**ุงูุชุธุงุฑ:**
- โ ุฏฺฏู ุดูุงุฑู ุตุฏ ุจุงุฑ ููโูพุฑุณู
- โ ุงููุงฺฉ ูุงูุน ุจุง ุนฺฉุณ ูุดูู ูุฏู
- โ ROI ู ููุช ูุงูุน ูุดูู ูุฏู
- โ ุฌูุณู ูุดุงูุฑู ุจุง ููฺฉ Calendly ฺฉุงุฑ ูฺฉูู

---

## ุฏูพูู:

```bash
# 1. SSH ุจู ุณุฑูุฑ
ssh root@88.99.45.159

# 2. ุฑูุชู ุจู ูพุฑูฺู
cd /opt/ArtinSmartRealtyPro

# 3. Pull ฺฉุฑุฏู ุชุบุฑุงุช
git pull origin main

# 4. Rebuild backend
docker-compose up -d --build backend

# 5. ฺฺฉ ฺฉุฑุฏู logs
docker-compose logs -f backend | grep -E "(ERROR|property|HARD_GATE)"
```

**ุฒูุงู:** 5 ุฏููู

---

## ูุจู ุงุฒ ุฏูพูู:

### โ ฺฉุงุฑูุง ฺฉู ุจุงุฏ ุจฺฉู:

1. **ุงุถุงูู ฺฉุฑุฏู ุงููุงฺฉ ุจู database:**
   ```sql
   -- ุงฺฏู table ุฎุงููุ ุจุงุฏ ฺฉ ููฺฉ sample ุงุถุงูู ฺฉู
   INSERT INTO tenant_properties (
       tenant_id, name, property_type, transaction_type,
       location, price, bedrooms, bathrooms, area_sqft,
       expected_roi, golden_visa_eligible, is_available
   ) VALUES (
       1, 'Marina Heights Tower', 'APARTMENT', 'BUY',
       'Dubai Marina', 1200000, 2, 2, 1250,
       8.0, true, true
   );
   ```

2. **ุงุฎุชุงุฑ: ฺฏุฑูุชู API key ุฌุฏุฏ ุจุฑุง Gemini** (ุงฺฏู voice ูโุฎูุง):
   - ุจุฑู https://aistudio.google.com/app/apikey
   - ฺฉ API key ุฌุฏุฏ ุจฺฏุฑ
   - ุชู `.env` ุนูุถ ฺฉู:
     ```
     GEMINI_API_KEY=AIza...ุฌุฏุฏ
     ```

3. **ุงุฎุชุงุฑ: Calendly link ุฑู ุนูุถ ฺฉู:**
   - ุงฺฏู ุญุณุงุจ Calendly ุฏุงุฑุ ููฺฉุช ุฑู ุชู `brain.py` ุฎุท 4135 ุจุฐุงุฑ
   - ูฺฏุฑูู ููู ููฺฉ sample ฺฉุงุฑ ูฺฉูู

---

## ุฎูุงุตู:

| ูุดฺฉู | ูุจู | ุจุนุฏ |
|------|-----|-----|
| ุดูุงุฑู | ุตุฏ ุจุงุฑ ูโูพุฑุณุฏ โ | ฺฉ ุจุงุฑ ูโูพุฑุณู โ |
| ุงููุงฺฉ | ููุท ูุชู ุฌูุฑฺฉ โ | ุนฺฉุณ + ููุช + ROI ูุงูุน โ |
| ูุดุงูุฑู | "ููุช ุฎุงู ูุฏุงุฑู" โ | ููฺฉ Calendly + ุชูุงุณ โ |
| ููู | ูพฺุฏู ู ุดฺฉุณุชู โ | ุณุงุฏู ู ูุงุถุญ โ |

---

**ุขูุงุฏู ุฏูพูู:** โ ุจูู  
**ูุงุฒ ุจู ุชุณุช:** ุจูู (5 ุฏููู)  
**ุฎุทุฑ ุดฺฉุณุชู:** ูพุงู (ููุท ููุทู state ุชุบุฑ ฺฉุฑุฏู)

---

## ูฺฉุชู ููู:

ุงฺฏู **database ุฎุงู** ุจุงุดู (ูฺ ููฺฉ ูุจุงุดู)ุ ุจุงุช ูโฺฏู:
> "๐ ูุชุงุณูุงูู ุฏุฑ ุญุงู ุญุงุถุฑ ููฺฉ ุจุง ุงู ูุดุฎุตุงุช ููุฌูุฏ ูุณุช."

ูพุณ **ูุจู ุงุฒ ุชุณุช**ุ ุญุชูุงู ฺฉ ููฺฉ sample ุชู database ุจุฐุงุฑ! ๐
